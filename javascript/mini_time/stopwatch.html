<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
    <title>Stopwatch</title>
    <link rel="stylesheet" href="../mini/style.css">
    <style>
        .container {
            padding-top: clamp(10%, 3vw, 30%);
        }

        .btn_time {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: row;
            gap: 1.5vw;
            padding: 2.5rem 0;
            transition: all 0.1s ease-in-out;
        }

        button {
            padding: 10px 25px;
            background: var(--color-second);
            color: var(--color-fourth);
            font-size: clamp(20px, 3vw, 50px);
            font-family: var(--font-default);
            cursor: pointer;
        }

        button:disabled {
            opacity: 0.5;
        }

        .reset {
            background: var(--color-fourth);
            color: var(--color-second);
        }

        .start {
            background: var(--color-third);
        }

        .lap {
            background: var(--color-fourth);
            color: var(--color-first);
        }

        .stop {
            background: var(--color-third);
        }

        .time {
            font-family: var(--font-default);
            font-size: clamp(40px, 10vw, 100px);
            transition: all 0.1s ease-in-out;
        }

        .time .msec {
            font-family: var(--font-default);
            font-size: 0.75em;
        }

        .lap_list {
            width: clamp(280px, 70vw, 900px);
            margin: 0 auto;
        }

        .lap_list ul {
            list-style: none;
            padding: 0;
            text-align: left;
        }

        .lap_list ul li {
            padding: 0.5rem;
        }

        .lap_list ul li+li {
            border-top: 1px dashed var(--color-fourth);
        }

        .lap_list ul li strong {
            margin-left: 2.75vw;
            font-family: var(--font-default);
            font-size: clamp(20px, 5.5vw, 40px);
        }

        .lap_list ul li .num {
            display: inline-flex;
            justify-content: center;
            width: clamp(7vw, 8vw, 100px);
            color: var(--color-third);
        }

        /* Îû© Ï∂îÍ∞Ä Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .lap-item.added {
            animation: popIn 0.4s ease-out;
        }

        @keyframes popIn {
            0% {
                transform: scale(0.8);
                opacity: 0.5;
            }

            60% {
                transform: scale(1.1);
                opacity: 1;
            }

            100% {
                transform: scale(1);
            }
        }

        /* ÏµúÍ≥†/ÏµúÏ†Ä ÌïòÏù¥ÎùºÏù¥Ìä∏ */
        .lap-item.best {
            color: var(--color-third);
            font-weight: bold;
        }

        .lap-item.worst {
        }

        .none {
            display: none;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <a href="javascript:history.back();" class="back">üëàüèª</a>

        <div class="container">
            <h1 class="stopwatch">
                <strong class="time">00:00<span class="msec">.00</span></strong>
            </h1>

            <!-- default ÎÖ∏Ï∂ú / start ÌÅ¥Î¶≠ Ïãú ÎπÑÎÖ∏Ï∂ú / stop ÌÅ¥Î¶≠ Ïãú ÎÖ∏Ï∂ú -->
            <div class="btn_time">
                <button class="reset" disabled>ResetüîÑÔ∏è</button><!-- default ÎπÑÌôúÏÑ± / stop ÌÅ¥Î¶≠ Ïãú ÌôúÏÑ±Ìôî -->
                <button class="start">Start‚ñ∂Ô∏è</button>
            </div>

            <!-- start ÌÅ¥Î¶≠ Ïãú ÎÖ∏Ï∂ú / stop ÌÅ¥Î¶≠ Ïãú ÎπÑÎÖ∏Ï∂ú -->
            <div class="btn_time none">
                <button class="lap">Lap‚è±Ô∏è</button>
                <button class="stop">Stop‚èπÔ∏è</button>
            </div>

            <!-- lap ÌÅ¥Î¶≠ Ïãú ÎÖ∏Ï∂ú, lap_time/lap_total ÏåìÏûÑ / reset ÌÅ¥Î¶≠ Ïãú Î¶¨Ïä§Ìä∏ ÏÇ¨ÎùºÏßê -->
            <div class="lap_list">
                <ul>
                    <!-- <li>
                        <strong class="num">0</strong>
                        <strong class="time lap_time">00:00<span class="msec">.00</span></strong>
                        <strong class="time lap_total">00:00<span class="msec">.00</span></strong>
                    </li> -->
                </ul>
            </div>
        </div>
    </div>
    <script>
        // performance.now() Í∏∞Î∞ò
        document.addEventListener("DOMContentLoaded", () => {
            const timeEl = document.querySelector(".stopwatch .time");
            const startBtn = document.querySelector(".start");
            const stopBtn = document.querySelector(".stop");
            const resetBtn = document.querySelector(".reset");
            const lapBtn = document.querySelector(".lap");
            const btnDefault = document.querySelector(".btn_time");
            const btnRunning = document.querySelectorAll(".btn_time")[1];
            const lapList = document.querySelector(".lap_list ul");
            const lapContainer = document.querySelector(".lap_list");

            let startTime = 0;
            let elapsed = 0; // ÎàÑÏ†Å Í≤ΩÍ≥º ÏãúÍ∞Ñ
            let running = false;
            let rafId = null;
            let lastLapTime = 0;
            let lapCount = 0;
            let laps = [];

            // ÏãúÍ∞Ñ Ìè¨Îß∑
            function formatTime(ms) {
                const totalSeconds = Math.floor(ms / 1000);
                const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
                const seconds = String(totalSeconds % 60).padStart(2, "0");
                const msec = String(Math.floor((ms % 1000) / 10)).padStart(2, "0");
                return { minutes, seconds, msec };
            }

            function updateDisplay(ms) {
                const { minutes, seconds, msec } = formatTime(ms);
                timeEl.innerHTML = `${minutes}:${seconds}<span class="msec">.${msec}</span>`;
            }

            // raf Î£®ÌîÑ
            function tick() {
                const now = performance.now();
                const diff = now - startTime + elapsed;
                updateDisplay(diff);
                rafId = requestAnimationFrame(tick);
            }

            // ÏãúÏûë
            startBtn.addEventListener("click", () => {
                if (running) return;
                running = true;
                startTime = performance.now();
                rafId = requestAnimationFrame(tick);

                btnDefault.classList.add("none");
                btnRunning.classList.remove("none");
                resetBtn.disabled = true;
            });

            // Ï§ëÏßÄ
            stopBtn.addEventListener("click", () => {
                if (!running) return;
                running = false;
                cancelAnimationFrame(rafId);

                elapsed += performance.now() - startTime;

                btnDefault.classList.remove("none");
                btnRunning.classList.add("none");
                resetBtn.disabled = false;
            });

            // Ïû¨ÏÑ§Ï†ï
            resetBtn.addEventListener("click", () => {
                elapsed = 0;
                lastLapTime = 0;
                lapCount = 0;
                laps = [];
                updateDisplay(0);
                lapList.innerHTML = "";
                lapContainer.classList.add("none");
                resetBtn.disabled = true;
            });

            // Îû©
            lapBtn.addEventListener("click", () => {
                if (!running) return;
                const now = performance.now();
                const currentTime = now - startTime + elapsed;

                const lapTime = currentTime - lastLapTime;
                lastLapTime = currentTime;
                lapCount++;

                laps.push({ num: lapCount, lapTime, total: currentTime });

                // li ÏÉùÏÑ±
                const { minutes, seconds, msec } = formatTime(lapTime);
                const { minutes: tMin, seconds: tSec, msec: tMsec } = formatTime(currentTime);

                const li = document.createElement("li");
                li.classList.add("lap-item");
                li.innerHTML = `
      <strong class="num">${lapCount}</strong>
      <strong class="time lap_time">${minutes}:${seconds}<span class="msec">.${msec}</span></strong>
      <strong class="time lap_total">${tMin}:${tSec}<span class="msec">.${tMsec}</span></strong>
    `;
                lapList.prepend(li);
                lapContainer.classList.remove("none");

                // Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º
                li.classList.add("added");
                setTimeout(() => li.classList.remove("added"), 500);

                // ÏµúÍ≥†/ÏµúÏ†Ä ÌïòÏù¥ÎùºÏù¥Ìä∏ Í∞±Ïã†
                highlightBestWorst();
            });

            // ÏµúÍ≥†/ÏµúÏ†Ä ÌïòÏù¥ÎùºÏù¥Ìä∏
            function highlightBestWorst() {
                if (laps.length < 2) return;

                // lapTime Í∏∞Ï§ÄÏúºÎ°ú ÎπÑÍµê
                const minLap = Math.min(...laps.map(l => l.lapTime));
                const maxLap = Math.max(...laps.map(l => l.lapTime));

                // Í∏∞Ï°¥ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†úÍ±∞
                lapList.querySelectorAll("li").forEach(li => {
                    li.classList.remove("best", "worst");
                });

                // Îã§Ïãú Î∂ÄÏó¨ (num Îß§Ïπ≠)
                laps.forEach(lap => {
                    const li = [...lapList.children].find(li =>
                        li.querySelector(".num").textContent == lap.num
                    );
                    if (lap.lapTime === minLap) li.classList.add("best");
                    if (lap.lapTime === maxLap) li.classList.add("worst");
                });
            }

            // Ï¥àÍ∏∞Ìôî
            updateDisplay(0);
        });

        /*
        // setInterval Í∏∞Î∞ò
        document.addEventListener("DOMContentLoaded", () => {
            const display = document.querySelector(".stopwatch .time");
            const msecEl = display.querySelector(".msec");
            const btnReset = document.querySelector(".btn_time .reset");
            const btnStart = document.querySelector(".btn_time .start");
            const btnLap = document.querySelector(".btn_time.none .lap");
            const btnStop = document.querySelector(".btn_time.none .stop");

            const btnBoxDefault = document.querySelectorAll(".btn_time")[0]; // ÏãúÏûë/Ïû¨ÏÑ§Ï†ï
            const btnBoxRunning = document.querySelectorAll(".btn_time")[1]; // Îû©/Ï§ëÏßÄ
            const lapListBox = document.querySelector(".lap_list ul");
            const lapContainer = document.querySelector(".lap_list");

            let startTime = 0;
            let elapsedTime = 0;
            let timerInterval;
            let lastLapTime = 0;
            let lapCount = 0;

            // ÏãúÍ∞Ñ Ìè¨Îß∑ÌåÖ (mm:ss.ms)
            function formatTime(ms) {
                const totalSeconds = Math.floor(ms / 1000);
                const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
                const seconds = String(totalSeconds % 60).padStart(2, "0");
                const milliseconds = String(Math.floor((ms % 1000) / 10)).padStart(2, "0");
                return { minutes, seconds, milliseconds };
            }

            function updateDisplay(ms) {
                const { minutes, seconds, milliseconds } = formatTime(ms);
                display.childNodes[0].nodeValue = `${minutes}:${seconds}`;
                msecEl.textContent = `.${milliseconds}`;
            }

            // ÏãúÏûë
            btnStart.addEventListener("click", () => {
                startTime = Date.now() - elapsedTime;
                timerInterval = setInterval(() => {
                    elapsedTime = Date.now() - startTime;
                    updateDisplay(elapsedTime);
                }, 10);

                btnBoxDefault.classList.add("none");
                btnBoxRunning.classList.remove("none");
                btnReset.disabled = true;
            });

            // Ï§ëÏßÄ
            btnStop.addEventListener("click", () => {
                clearInterval(timerInterval);
                btnBoxRunning.classList.add("none");
                btnBoxDefault.classList.remove("none");
                btnReset.disabled = false;
            });

            // Ïû¨ÏÑ§Ï†ï
            btnReset.addEventListener("click", () => {
                clearInterval(timerInterval);
                elapsedTime = 0;
                lastLapTime = 0;
                lapCount = 0;
                updateDisplay(0);
                lapListBox.innerHTML = "";
                lapContainer.classList.add("none");
                btnReset.disabled = true;
            });

            // Îû©
            btnLap.addEventListener("click", () => {
                const currentLapTime = elapsedTime - lastLapTime;
                lastLapTime = elapsedTime;
                lapCount++;

                const lapItem = document.createElement("li");
                lapItem.innerHTML = `
                    <strong class="num">${lapCount}</strong>
                    <strong class="time lap_time">${formatTime(currentLapTime).minutes}:${formatTime(currentLapTime).seconds}<span class="msec">.${formatTime(currentLapTime).milliseconds}</span></strong>
                    <strong class="time lap_total">${formatTime(elapsedTime).minutes}:${formatTime(elapsedTime).seconds}<span class="msec">.${formatTime(elapsedTime).milliseconds}</span></strong>
                `;
                lapListBox.prepend(lapItem); // ÏµúÏã† Í∏∞Î°ù ÏúÑÎ°ú Ï∂îÍ∞Ä
                lapContainer.classList.remove("none");
            });

            // Ï¥àÍ∏∞Ìôî ÌôîÎ©¥ ÌëúÏãú
            updateDisplay(0);
        });
        */
    </script>

</body>

</html>