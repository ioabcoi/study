<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
    <title>World</title>
    <link rel="stylesheet" href="../mini/style.css">
    <style>
        .container {
            margin-top: clamp(120px, 20vw, 200px);
            padding: 1rem;
        }

        .text {
            position: fixed;
            left: 0;
            top: clamp(30px, 10vw, 100px);
            width: 100%;
            color: var(--color-third);
            font-family: var(--font-default);
            font-size: clamp(20px, 8vw, 40px);
            text-align: center;
        }

        .text:hover {
            text-shadow: 3px 3px 0 var(--color-fourth);
        }

        .index {
            display: grid;
            place-items: center;
            grid-template-columns: repeat(2, 1fr);
            align-items: stretch;
            justify-content: stretch;
            gap: clamp(1vw, 2vw, 20px);
            width: clamp(280px, 80%, 1080px);
            margin: 0 auto;
        }

        .item {
            display: flex;
            align-items: stretch;
            justify-content: stretch;
            width: 100%;
            height: 100%;
        }

        .item .box {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            width: 100%;
            height: 100%;
            padding: clamp(2vw, 5vw, 20px);
            background: var(--color-second);
            border-radius: 10px;
        }

        .item .box * {
            color: var(--color-fourth);
            font-family: var(--font-default);
            font-size: clamp(18px, 4vw, 28px);
        }

        .item .box .city {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px dashed var(--color-fourth);
            color: var(--color-third);
        }

        .item .box .datetime span {
            display: block;
        }

        .item .box:hover {
            background: var(--color-third);
            box-shadow: 5px 5px 0 var(--color-fourth);
        }

        .item .box:hover .city {
            color: var(--color-first);
        }

        .box_add {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: row;
            gap: 1.5vw;
            width: clamp(280px, 80%, 1080px);
            margin: 0 auto;
            padding: 2.5rem 0;
            transition: all 0.1s ease-in-out;
        }

        select {
            display: flex;
            padding: 15px;
            background: var(--color-fourth);
            border: 1px solid var(--color-fourth);
            color: var(--color-third);
            font-size: clamp(20px, 3vw, 50px);
            font-family: var(--font-default);
            cursor: pointer;
        }

        select option {
            font-size: clamp(20px, 3vw, 50px);
            font-family: var(--font-default);
        }

        button {
            display: flex;
            padding: 10px 15px;
            background: var(--color-third);
            border: 1px solid var(--color-third);
            color: var(--color-fourth);
            font-size: clamp(20px, 3vw, 50px);
            font-family: var(--font-default);
            cursor: pointer;
        }

        .remove {
            position: absolute;
            right: 0.5rem;
            top: 0.5rem;
            background: none;
            border: 0;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <a href="javascript:history.back();" class="back">👈🏻</a>

        <div class="container">
            <div class="world-clock">
                <h1 class="text">세계 시계</h1>
                <ul class="index">
                    <!-- <li class="item">
                        <div class="box">
                            <strong class="city">대한민국 서울</strong>
                            <div class="datetime">
                                <span class="date" data-timezone="Asia/Seoul">0000-00-00 (요일)</span>
                                <span class="time" data-timezone="Asia/Seoul">00:00:00</span>
                            </div>
                        </div>
                    </li>
                    <li class="item">
                        <div class="box">
                            <strong class="city">일본 도쿄</strong>
                            <div class="datetime">
                                <span class="date" data-timezone="Asia/Tokyo">0000-00-00 (요일)</span>
                                <span class="time" data-timezone="Asia/Tokyo">00:00:00</span>
                            </div>
                        </div>
                    </li>
                    <li class="item">
                        <div class="box">
                            <strong class="city">스위스 취리히</strong>
                            <div class="datetime">
                                <span class="date" data-timezone="Europe/Zurich">0000-00-00 (요일)</span>
                                <span class="time" data-timezone="Europe/Zurich">00:00:00</span>
                            </div>
                        </div>
                    </li>
                    <li class="item">
                        <div class="box">
                            <strong class="city">미국 뉴욕</strong>
                            <div class="datetime">
                                <span class="date" data-timezone="America/New_York">0000-00-00 (요일)</span>
                                <span class="time" data-timezone="America/New_York">00:00:00</span>
                            </div>
                        </div>
                    </li> -->
                </ul>

                <div class="box_add">
                    <select name="" id="" class="sel">
                        <option value="">🗺️ 국가 선택</option>
                        <option value="Asia/Shanghai" data-city="중국 상하이">중국 상하이</option>
                        <option value="Europe/London" data-city="영국 런던">영국 런던</option>
                        <option value="Australia/Sydney" data-city="호주 시드니">호주 시드니</option>
                        <option value="America/Los_Angeles" data-city="미국 LA">미국 LA</option>
                        <option value="America/Chicago" data-city="미국 시카고">미국 시카고</option>
                        <option value="Europe/Paris" data-city="프랑스 파리">프랑스 파리</option>
                    </select>
                    <button class="add">➕ 추가</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        function updateWorldClock() {
            const now = new Date();

            document.querySelectorAll(".world-clock .datetime").forEach(wrapper => {
                const tz = wrapper.querySelector(".date").dataset.timezone;

                // 날짜 포맷
                const dateFormatter = new Intl.DateTimeFormat("ko-KR", {
                    timeZone: tz,
                    year: "numeric",
                    month: "2-digit",
                    day: "2-digit",
                    // weekday: "short"
                    weekday: "long"
                });

                // 시간 포맷
                const timeFormatter = new Intl.DateTimeFormat("ko-KR", {
                    timeZone: tz,
                    hour: "2-digit",
                    minute: "2-digit",
                    second: "2-digit",
                    hour12: false
                });

                wrapper.querySelector(".date").textContent = dateFormatter.format(now);
                wrapper.querySelector(".time").textContent = timeFormatter.format(now);
            });
        }

        // 최초 실행 + 1초마다 갱신
        updateWorldClock();
        setInterval(updateWorldClock, 1000);

        const select = document.querySelector(".sel");
        const addBtn = document.querySelector(".add");
        const indexList = document.querySelector(".index");

        // 기본 도시들
        const defaultCities = [
            { tz: "Asia/Seoul", city: "대한민국 서울" },
            { tz: "Asia/Tokyo", city: "일본 도쿄" },
            { tz: "Europe/Zurich", city: "스위스 취리히" },
            { tz: "America/New_York", city: "미국 뉴욕" },
        ];

        // 저장/불러오기 함수
        function saveCities() {
            const cities = Array.from(indexList.querySelectorAll(".date")).map(el => ({
                tz: el.dataset.timezone,
                city: el.closest(".box").querySelector(".city").textContent
            }));
            localStorage.setItem("worldClockCities", JSON.stringify(cities));
        }

        function loadCities() {
            const saved = JSON.parse(localStorage.getItem("worldClockCities") || "[]");

            // 저장된 게 있으면 그걸 불러오기
            if (saved.length > 0) {
                saved.forEach(({ tz, city }) => createCityItem(tz, city));
            } else {
                // 없으면 기본 도시 세팅
                defaultCities.forEach(({ tz, city }) => createCityItem(tz, city));
            }
            updateWorldClock();
        }

        // li 생성 함수
        function createCityItem(tz, city) {
            const li = document.createElement("li");
            li.className = "item";
            li.innerHTML = `
        <div class="box">
            <strong class="city">${city}</strong>
            <div class="datetime">
                <span class="date" data-timezone="${tz}">0000-00-00 (요일)</span>
                <span class="time" data-timezone="${tz}">00:00:00</span>
            </div>
            <button class="remove">➖</button>
        </div>
    `;
            indexList.appendChild(li);
        }

        // 도시 추가
        addBtn.addEventListener("click", () => {
            const option = select.options[select.selectedIndex];
            const tz = option.value;
            const city = option.dataset.city;

            if (!tz) return;

            // 중복 체크
            const exists = Array.from(indexList.querySelectorAll(".date"))
                .some(el => el.dataset.timezone === tz);
            if (exists) {
                alert("이미 추가된 도시예요!");
                return;
            }

            createCityItem(tz, city);
            updateWorldClock();
            saveCities(); // 추가 후 저장
        });

        // 삭제 버튼 이벤트 위임
        indexList.addEventListener("click", (e) => {
            if (e.target.classList.contains("remove")) {
                e.target.closest(".item").remove();
                saveCities(); // 삭제 후 저장
            }
        });

        // 페이지 로드 시 저장된 데이터 불러오기
        document.addEventListener("DOMContentLoaded", loadCities);

    </script>

</body>

</html>