<!DOCTYPE html>
<html lang="en">
<head>
    <!-- head -->
    <script src="../include/head.js"></script>
    <!-- // head -->
    
    <title>dragdrop</title>
</head>
<body data-theme="light">

    <!-- code_wrap -->
    <div class="code_wrap">
        <h1>dragdrop</h1>

        <!-- code_area -->
        <div class="code_tit">draggable item (pc/mo)</div>
        <div class="code_area" data-style="vertical">
            <!-- code_ui -->
            <div class="code_ui">
                <div class="code_ui_box">
<style type="text/css">
    .container {height:120px;margin:10px;padding:10px;background-color:green;border-radius:8px;}
    .container button {display:inline-flex;align-items:center;justify-content:center;width:70px;height:70px;border:none;border-radius:8px;margin:12px;cursor:move;font-size:30px;background:#eaeaea4f;}
    .container .draggable.dragging {opacity:0.5;}
</style>
<div class="container">
    <button class="draggable" draggable="true">ğŸ¦Š</button>
    <button class="draggable" draggable="true">ğŸ¸</button>
</div>
<div class="container">
    <button class="draggable" draggable="true">ğŸ¶</button>
    <button class="draggable" draggable="true">ğŸ±</button>
</div>
<div class="container">
    <button class="draggable" draggable="true">ğŸŒ¼</button>
    <button class="draggable" draggable="true">ğŸŒ»</button>
</div>
<script type='text/javascript'>
/*
dragstart ì´ë²¤íŠ¸í•¸ë“¤ëŸ¬ì—ì„œÂ e.dataTransfer.setDataë¡œ ì „ë‹¬í•  ë°ì´í„°ë¥¼ ì§€ì •í•´ì¤€ë‹¤.Â 
setDataëŠ” í‚¤-ê°’ í˜•ì‹ìœ¼ë¡œ ì €ì¥í•˜ê¸° ë•Œë¬¸ì—, í‚¤ë§Œ ë‹¤ë¥´ë©´ ì—¬ëŸ¬ ê°œì˜ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤.
dragoverì´ë²¤íŠ¸ì—ì„œëŠ”Â e.preventDefault()ë¡œ drop ì´ë²¤íŠ¸ê°€ í˜¸ì¶œë  ìˆ˜ ìˆê²Œ í•´ì£¼ê³ 
drop ì´ë²¤íŠ¸ì—ì„œÂ e.dataTransfer.getDataë¡œ ë°ì´í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.
*/

const draggables = document.querySelectorAll(".draggable");
const containers = document.querySelectorAll(".container");

// ë°ìŠ¤í¬íƒ‘ìš© ë“œë˜ê·¸ ì´ë²¤íŠ¸
draggables.forEach(draggable => {
    draggable.addEventListener("dragstart", () => {
        draggable.classList.add("dragging");

        // ë“œë˜ê·¸ ì‹œì‘ ì‹œ í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì „ì†¡ ë°ì´í„°ì— ì¶”ê°€
        e.dataTransfer.setData('text/plain', e.target.textContent);
    });

    draggable.addEventListener("dragend", () => {
        draggable.classList.remove("dragging");
    });
});

containers.forEach(container => {
    container.addEventListener("dragover", e => {
        e.preventDefault();
        const afterElement = getDragAfterElement(container, e.clientX);
        const draggable = document.querySelector(".dragging");
        if (afterElement === undefined) {
            container.appendChild(draggable);
        } else {
            container.insertBefore(draggable, afterElement);
        }
    });
});

function getDragAfterElement(container, x) {
    const draggableElements = [
        ...container.querySelectorAll(".draggable:not(.dragging)"),
    ];

    return draggableElements.reduce(
        (closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = x - box.left - box.width / 2;
            // console.log(offset);
            if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
            } else {
                return closest;
            }
        },
        { offset: Number.NEGATIVE_INFINITY },
    ).element;
}

// ëª¨ë°”ì¼ í„°ì¹˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì¶”ê°€
draggables.forEach(draggable => {
    let isDragging = false; // í„°ì¹˜ ë“œë˜ê·¸ ìƒíƒœ ë³€ìˆ˜

    // í„°ì¹˜ ì‹œì‘
    draggable.addEventListener("touchstart", (e) => {
        isDragging = true;
        draggable.classList.add("dragging");

        // í„°ì¹˜í•œ ìœ„ì¹˜ì— ë”°ë¼ ìš”ì†Œì˜ ì´ë™ ì‹œì‘
        const touch = e.touches[0];
        draggable.style.position = 'absolute';
        draggable.style.left = `${touch.clientX - draggable.offsetWidth / 2 + window.scrollX}px`;
        draggable.style.top = `${touch.clientY - draggable.offsetHeight / 2 + window.scrollY}px`;

        // ìŠ¤í¬ë¡¤ ë°©ì§€
        e.preventDefault();
    });

    // í„°ì¹˜ ì´ë™
    draggable.addEventListener("touchmove", (e) => {
        if (isDragging) {
            const touch = e.touches[0];
            draggable.style.left = `${touch.clientX - draggable.offsetWidth / 2 + window.scrollX}px`;
            draggable.style.top = `${touch.clientY - draggable.offsetHeight / 2 + window.scrollY}px`;
        }

        // ìŠ¤í¬ë¡¤ ë°©ì§€
        e.preventDefault();
    });

    // í„°ì¹˜ ì¢…ë£Œ
    draggable.addEventListener("touchend", () => {
        isDragging = false;
        draggable.classList.remove("dragging");

        const afterElement = getDragAfterElement(container, touch.clientX);
        if (container.contains(draggable)) {
            if (afterElement === undefined) {
                container.appendChild(draggable);
            } else {
                container.insertBefore(draggable, afterElement);
            }
        }

        // ìš”ì†Œ ìœ„ì¹˜ë¥¼ ì´ˆê¸°í™” (ìƒëŒ€ ìœ„ì¹˜ì—ì„œ ì›ë˜ ìœ„ì¹˜ë¡œ)
        draggable.style.position = 'relative';
        draggable.style.left = '0px';
        draggable.style.top = '0px';

        // ìŠ¤í¬ë¡¤ ë°©ì§€
        e.preventDefault();
    });
});

// ê¸°ì¡´ getDragAfterElement í•¨ìˆ˜
function getDragAfterElement(container, x) {
    const draggableElements = [
        ...container.querySelectorAll(".draggable:not(.dragging)"),
    ];

    return draggableElements.reduce(
        (closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = x - box.left - box.width / 2;
            if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
            } else {
                return closest;
            }
        },
        { offset: Number.NEGATIVE_INFINITY },
    ).element;
}

/*
í„°ì¹˜ ì‹œì‘ (touchstart): í„°ì¹˜ê°€ ì‹œì‘ë˜ë©´, isDragging ë³€ìˆ˜ë¥¼ trueë¡œ ì„¤ì •í•˜ê³ , ì•„ì´í…œì˜ ìœ„ì¹˜ë¥¼ í„°ì¹˜í•œ ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.
í„°ì¹˜ ì´ë™ (touchmove): í„°ì¹˜ê°€ ì´ë™í•  ë•Œë§ˆë‹¤ ì•„ì´í…œì„ ë”°ë¼ ì›€ì§ì´ê²Œ í•˜ê³ , ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ë‹¤ë¥¸ ìš”ì†Œì™€ì˜ ìœ„ì¹˜ë¥¼ ê³„ì‚°í•˜ì—¬ ë“œë˜ê·¸ ìœ„ì¹˜ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
í„°ì¹˜ ì¢…ë£Œ (touchend): í„°ì¹˜ê°€ ì¢…ë£Œë˜ë©´ isDragging ë³€ìˆ˜ë¥¼ falseë¡œ ì„¤ì •í•˜ê³ , ì•„ì´í…œì˜ ìœ„ì¹˜ë¥¼ ì´ˆê¸°í™”í•˜ì—¬ ì›ë˜ ìœ„ì¹˜ë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.
*/
</script>
                </div>
            </div>
            <!-- // code_ui -->
            <!-- code_view -->
            <div class="code_view"><div class="code_view_box"><textarea class="code_preview"></textarea></div></div>
            <!-- // code_view -->
        </div>
        <!-- // code_area -->

    </div>
    <!-- // code_wrap -->

    <!-- foot -->
    <script src="../include/foot.js"></script>
    <!-- // foot -->
</body>
</html>